var AgentModel = tortoise_require('agentmodel');
var ColorModel = tortoise_require('engine/core/colormodel');
var Exception = tortoise_require('util/exception');
var Link = tortoise_require('engine/core/link');
var LinkSet = tortoise_require('engine/core/linkset');
var Meta = tortoise_require('meta');
var NLMath = tortoise_require('util/nlmath');
var NLType = tortoise_require('engine/core/typechecker');
var PatchSet = tortoise_require('engine/core/patchset');
var PenBundle = tortoise_require('engine/plot/pen');
var Plot = tortoise_require('engine/plot/plot');
var PlotOps = tortoise_require('engine/plot/plotops');
var StrictMath = tortoise_require('shim/strictmath');
var Tasks = tortoise_require('engine/prim/tasks');
var Turtle = tortoise_require('engine/core/turtle');
var TurtleSet = tortoise_require('engine/core/turtleset');
var notImplemented = tortoise_require('util/notimplemented');
var { DeathInterrupt, StopInterrupt } = tortoise_require('util/interrupts');

var linkShapes = {"default":{"name":"default","direction-indicator":{"name":"link direction","editableColorIndex":0,"rotate":true,"elements":[{"x1":150,"y1":150,"x2":90,"y2":180,"type":"line","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true},{"x1":150,"y1":150,"x2":210,"y2":180,"type":"line","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true}]},"curviness":0,"lines":[{"x-offset":-0.2,"is-visible":false,"dash-pattern":[0,1]},{"x-offset":0,"is-visible":true,"dash-pattern":[1,0]},{"x-offset":0.2,"is-visible":false,"dash-pattern":[0,1]}]}};
var turtleShapes = {"default":{"name":"default","editableColorIndex":0,"rotate":true,"elements":[{"xcors":[150,40,150,260],"ycors":[5,250,205,250],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true}]},"airplane":{"name":"airplane","editableColorIndex":0,"rotate":true,"elements":[{"xcors":[150,135,120,120,15,15,120,135,105,120,150,180,210,165,180,285,285,180,180,165],"ycors":[0,15,60,105,165,195,180,240,270,285,270,285,270,240,180,195,165,105,60,15],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true}]},"arrow":{"name":"arrow","editableColorIndex":0,"rotate":true,"elements":[{"xcors":[150,0,105,105,195,195,300],"ycors":[0,150,150,293,293,150,150],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true}]},"box":{"name":"box","editableColorIndex":0,"rotate":false,"elements":[{"xcors":[150,285,285,150],"ycors":[285,225,75,135],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[150,15,150,285],"ycors":[135,75,15,75],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[15,15,150,150],"ycors":[75,225,285,135],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x1":150,"y1":285,"x2":150,"y2":135,"type":"line","color":"rgba(0, 0, 0, 1)","filled":false,"marked":false},{"x1":150,"y1":135,"x2":15,"y2":75,"type":"line","color":"rgba(0, 0, 0, 1)","filled":false,"marked":false},{"x1":150,"y1":135,"x2":285,"y2":75,"type":"line","color":"rgba(0, 0, 0, 1)","filled":false,"marked":false}]},"bug":{"name":"bug","editableColorIndex":0,"rotate":true,"elements":[{"x":96,"y":182,"diam":108,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":110,"y":127,"diam":80,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":110,"y":75,"diam":80,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x1":150,"y1":100,"x2":80,"y2":30,"type":"line","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true},{"x1":150,"y1":100,"x2":220,"y2":30,"type":"line","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true}]},"butterfly":{"name":"butterfly","editableColorIndex":0,"rotate":true,"elements":[{"xcors":[150,209,225,225,195,165,150],"ycors":[165,199,225,255,270,255,240],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[150,89,75,75,105,135,150],"ycors":[165,198,225,255,270,255,240],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[139,100,55,25,10,10,25,40,85,139],"ycors":[148,105,90,90,105,135,180,195,194,163],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[162,200,245,275,290,290,275,260,215,162],"ycors":[150,105,90,90,105,135,180,195,195,165],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[150,135,120,135,150,165,180,165],"ycors":[255,225,150,120,105,120,150,225],"type":"polygon","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false},{"x":135,"y":90,"diam":30,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false},{"x1":150,"y1":105,"x2":195,"y2":60,"type":"line","color":"rgba(0, 0, 0, 1)","filled":false,"marked":false},{"x1":150,"y1":105,"x2":105,"y2":60,"type":"line","color":"rgba(0, 0, 0, 1)","filled":false,"marked":false}]},"car":{"name":"car","editableColorIndex":0,"rotate":false,"elements":[{"xcors":[300,279,261,240,226,213,203,185,159,135,75,0,0,0,300,300],"ycors":[180,164,144,135,132,106,84,63,50,50,60,150,165,225,225,180],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":180,"y":180,"diam":90,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false},{"x":30,"y":180,"diam":90,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false},{"xcors":[162,132,134,209,194,189,180],"ycors":[80,78,135,135,105,96,89],"type":"polygon","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false},{"x":47,"y":195,"diam":58,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":195,"y":195,"diam":58,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true}]},"circle":{"name":"circle","editableColorIndex":0,"rotate":false,"elements":[{"x":0,"y":0,"diam":300,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true}]},"circle 2":{"name":"circle 2","editableColorIndex":0,"rotate":false,"elements":[{"x":0,"y":0,"diam":300,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":30,"y":30,"diam":240,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false}]},"cloud":{"name":"cloud","editableColorIndex":0,"rotate":false,"elements":[{"x":13,"y":118,"diam":94,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":86,"y":101,"diam":127,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":51,"y":51,"diam":108,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":118,"y":43,"diam":95,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":158,"y":68,"diam":134,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true}]},"co2-molecule":{"name":"co2-molecule","editableColorIndex":0,"rotate":true,"elements":[{"x":183,"y":63,"diam":84,"type":"circle","color":"rgba(255, 255, 255, 1)","filled":true,"marked":false},{"x":183,"y":63,"diam":84,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":false,"marked":false},{"x":75,"y":75,"diam":150,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":75,"y":75,"diam":150,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":false,"marked":false},{"x":33,"y":63,"diam":84,"type":"circle","color":"rgba(255, 255, 255, 1)","filled":true,"marked":false},{"x":33,"y":63,"diam":84,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":false,"marked":false}]},"cow":{"name":"cow","editableColorIndex":0,"rotate":false,"elements":[{"xcors":[200,197,179,177,166,140,93,78,72,49,48,37,25,25,45,103,179,198,252,272,293,285,255,242,224],"ycors":[193,249,249,196,187,189,191,179,211,209,181,149,120,89,72,84,75,76,64,81,103,121,121,118,167],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[73,86,62,48],"ycors":[210,251,249,208],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[25,16,9,23,25,39],"ycors":[114,195,204,213,200,123],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true}]},"cylinder":{"name":"cylinder","editableColorIndex":0,"rotate":false,"elements":[{"x":0,"y":0,"diam":300,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true}]},"dot":{"name":"dot","editableColorIndex":0,"rotate":false,"elements":[{"x":90,"y":90,"diam":120,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true}]},"face happy":{"name":"face happy","editableColorIndex":0,"rotate":false,"elements":[{"x":8,"y":8,"diam":285,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":60,"y":75,"diam":60,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false},{"x":180,"y":75,"diam":60,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false},{"xcors":[150,90,62,47,67,90,109,150,192,210,227,251,236,212],"ycors":[255,239,213,191,179,203,218,225,218,203,181,194,217,240],"type":"polygon","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false}]},"face neutral":{"name":"face neutral","editableColorIndex":0,"rotate":false,"elements":[{"x":8,"y":7,"diam":285,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":60,"y":75,"diam":60,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false},{"x":180,"y":75,"diam":60,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false},{"xmin":60,"ymin":195,"xmax":240,"ymax":225,"type":"rectangle","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false}]},"face sad":{"name":"face sad","editableColorIndex":0,"rotate":false,"elements":[{"x":8,"y":8,"diam":285,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":60,"y":75,"diam":60,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false},{"x":180,"y":75,"diam":60,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false},{"xcors":[150,90,62,47,67,90,109,150,192,210,227,251,236,212],"ycors":[168,184,210,232,244,220,205,198,205,220,242,229,206,183],"type":"polygon","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false}]},"fish":{"name":"fish","editableColorIndex":0,"rotate":false,"elements":[{"xcors":[44,21,15,0,15,0,13,20,45],"ycors":[131,87,86,120,150,180,214,212,166],"type":"polygon","color":"rgba(255, 255, 255, 1)","filled":true,"marked":false},{"xcors":[135,119,95,76,46,60],"ycors":[195,235,218,210,204,165],"type":"polygon","color":"rgba(255, 255, 255, 1)","filled":true,"marked":false},{"xcors":[75,83,71,86,166,135],"ycors":[45,77,103,114,78,60],"type":"polygon","color":"rgba(255, 255, 255, 1)","filled":true,"marked":false},{"xcors":[30,151,226,280,292,292,287,270,195,151,30],"ycors":[136,77,81,119,146,160,170,195,210,212,166],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":215,"y":106,"diam":30,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false}]},"flag":{"name":"flag","editableColorIndex":0,"rotate":false,"elements":[{"xmin":60,"ymin":15,"xmax":75,"ymax":300,"type":"rectangle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[90,270,90],"ycors":[150,90,30],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x1":75,"y1":135,"x2":90,"y2":135,"type":"line","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true},{"x1":75,"y1":45,"x2":90,"y2":45,"type":"line","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true}]},"flower":{"name":"flower","editableColorIndex":0,"rotate":false,"elements":[{"xcors":[135,165,180,180,150,165,195,195,165],"ycors":[120,165,210,240,300,300,240,195,135],"type":"polygon","color":"rgba(89, 176, 60, 1)","filled":true,"marked":false},{"x":85,"y":132,"diam":38,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":130,"y":147,"diam":38,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":192,"y":85,"diam":38,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":85,"y":40,"diam":38,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":177,"y":40,"diam":38,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":177,"y":132,"diam":38,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":70,"y":85,"diam":38,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":130,"y":25,"diam":38,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":96,"y":51,"diam":108,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":113,"y":68,"diam":74,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false},{"xcors":[189,219,249,279,234],"ycors":[233,188,173,188,218],"type":"polygon","color":"rgba(89, 176, 60, 1)","filled":true,"marked":false},{"xcors":[180,150,105,75,135],"ycors":[255,210,210,240,240],"type":"polygon","color":"rgba(89, 176, 60, 1)","filled":true,"marked":false}]},"house":{"name":"house","editableColorIndex":0,"rotate":false,"elements":[{"xmin":45,"ymin":120,"xmax":255,"ymax":285,"type":"rectangle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xmin":120,"ymin":210,"xmax":180,"ymax":285,"type":"rectangle","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false},{"xcors":[15,150,285],"ycors":[120,15,120],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x1":30,"y1":120,"x2":270,"y2":120,"type":"line","color":"rgba(0, 0, 0, 1)","filled":false,"marked":false}]},"leaf":{"name":"leaf","editableColorIndex":0,"rotate":false,"elements":[{"xcors":[150,135,120,60,30,60,60,15,30,15,40,45,60,90,105,120,105,120,135,150,165,180,195,180,195,210,240,255,263,285,270,285,240,240,270,240,180,165],"ycors":[210,195,210,210,195,180,165,135,120,105,104,90,90,105,120,120,60,60,30,15,30,60,60,120,120,105,90,90,104,105,120,135,165,180,195,210,210,195],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[135,135,120,105,105,135,165,165],"ycors":[195,240,255,255,285,285,240,195],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true}]},"line":{"name":"line","editableColorIndex":0,"rotate":true,"elements":[{"x1":150,"y1":0,"x2":150,"y2":300,"type":"line","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true}]},"line half":{"name":"line half","editableColorIndex":0,"rotate":true,"elements":[{"x1":150,"y1":0,"x2":150,"y2":150,"type":"line","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true}]},"molecule water":{"name":"molecule water","editableColorIndex":0,"rotate":true,"elements":[{"x":183,"y":63,"diam":84,"type":"circle","color":"rgba(255, 255, 255, 1)","filled":true,"marked":false},{"x":183,"y":63,"diam":84,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":false,"marked":false},{"x":75,"y":75,"diam":150,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":75,"y":75,"diam":150,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":false,"marked":false},{"x":33,"y":63,"diam":84,"type":"circle","color":"rgba(255, 255, 255, 1)","filled":true,"marked":false},{"x":33,"y":63,"diam":84,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":false,"marked":false}]},"pentagon":{"name":"pentagon","editableColorIndex":0,"rotate":false,"elements":[{"xcors":[150,15,60,240,285],"ycors":[15,120,285,285,120],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true}]},"person":{"name":"person","editableColorIndex":0,"rotate":false,"elements":[{"x":110,"y":5,"diam":80,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[105,120,90,105,135,150,165,195,210,180,195],"ycors":[90,195,285,300,300,225,300,300,285,195,90],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xmin":127,"ymin":79,"xmax":172,"ymax":94,"type":"rectangle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[195,240,225,165],"ycors":[90,150,180,105],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[105,60,75,135],"ycors":[90,150,180,105],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true}]},"plant":{"name":"plant","editableColorIndex":0,"rotate":false,"elements":[{"xmin":135,"ymin":90,"xmax":165,"ymax":300,"type":"rectangle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[135,90,45,75,135],"ycors":[255,210,195,255,285],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[165,210,255,225,165],"ycors":[255,210,195,255,285],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[135,90,45,75,135],"ycors":[180,135,120,180,210],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[165,165,225,255,210],"ycors":[180,210,180,120,135],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[135,90,45,75,135],"ycors":[105,60,45,105,135],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[165,165,225,255,210],"ycors":[105,135,105,45,60],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[135,120,150,180,165],"ycors":[90,45,15,45,90],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true}]},"ray":{"name":"ray","editableColorIndex":0,"rotate":true,"elements":[{"x1":150,"y1":0,"x2":150,"y2":315,"type":"line","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true},{"x1":120,"y1":255,"x2":150,"y2":225,"type":"line","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true},{"x1":150,"y1":225,"x2":180,"y2":255,"type":"line","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true},{"x1":120,"y1":165,"x2":150,"y2":135,"type":"line","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true},{"x1":120,"y1":75,"x2":150,"y2":45,"type":"line","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true},{"x1":150,"y1":135,"x2":180,"y2":165,"type":"line","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true},{"x1":150,"y1":45,"x2":180,"y2":75,"type":"line","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true}]},"square":{"name":"square","editableColorIndex":0,"rotate":false,"elements":[{"xmin":30,"ymin":30,"xmax":270,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true}]},"square 2":{"name":"square 2","editableColorIndex":0,"rotate":false,"elements":[{"xmin":30,"ymin":30,"xmax":270,"ymax":270,"type":"rectangle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xmin":60,"ymin":60,"xmax":240,"ymax":240,"type":"rectangle","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false}]},"star":{"name":"star","editableColorIndex":0,"rotate":false,"elements":[{"xcors":[151,185,298,207,242,151,59,94,3,116],"ycors":[1,108,108,175,282,216,282,175,108,108],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true}]},"target":{"name":"target","editableColorIndex":0,"rotate":false,"elements":[{"x":0,"y":0,"diam":300,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":30,"y":30,"diam":240,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false},{"x":60,"y":60,"diam":180,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":90,"y":90,"diam":120,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false},{"x":120,"y":120,"diam":60,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true}]},"tree":{"name":"tree","editableColorIndex":0,"rotate":false,"elements":[{"x":118,"y":3,"diam":94,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xmin":120,"ymin":195,"xmax":180,"ymax":300,"type":"rectangle","color":"rgba(157, 110, 72, 1)","filled":true,"marked":false},{"x":65,"y":21,"diam":108,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":116,"y":41,"diam":127,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":45,"y":90,"diam":120,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":104,"y":74,"diam":152,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true}]},"triangle":{"name":"triangle","editableColorIndex":0,"rotate":false,"elements":[{"xcors":[150,15,285],"ycors":[30,255,255],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true}]},"triangle 2":{"name":"triangle 2","editableColorIndex":0,"rotate":false,"elements":[{"xcors":[150,15,285],"ycors":[30,255,255],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[151,225,75],"ycors":[99,223,224],"type":"polygon","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false}]},"truck":{"name":"truck","editableColorIndex":0,"rotate":false,"elements":[{"xmin":4,"ymin":45,"xmax":195,"ymax":187,"type":"rectangle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[296,296,259,244,208,207],"ycors":[193,150,134,104,104,194],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xmin":195,"ymin":60,"xmax":195,"ymax":105,"type":"rectangle","color":"rgba(255, 255, 255, 1)","filled":true,"marked":false},{"xcors":[238,252,219,218],"ycors":[112,141,141,112],"type":"polygon","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false},{"x":234,"y":174,"diam":42,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false},{"xmin":181,"ymin":185,"xmax":214,"ymax":194,"type":"rectangle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":144,"y":174,"diam":42,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false},{"x":24,"y":174,"diam":42,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false},{"x":24,"y":174,"diam":42,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true},{"x":144,"y":174,"diam":42,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true},{"x":234,"y":174,"diam":42,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true}]},"turtle":{"name":"turtle","editableColorIndex":0,"rotate":true,"elements":[{"xcors":[215,240,246,228,215,193],"ycors":[204,233,254,266,252,210],"type":"polygon","color":"rgba(89, 176, 60, 1)","filled":true,"marked":false},{"xcors":[195,225,245,260,269,261,240,225,210],"ycors":[90,75,75,89,108,124,105,105,105],"type":"polygon","color":"rgba(89, 176, 60, 1)","filled":true,"marked":false},{"xcors":[105,75,55,40,31,39,60,75,90],"ycors":[90,75,75,89,108,124,105,105,105],"type":"polygon","color":"rgba(89, 176, 60, 1)","filled":true,"marked":false},{"xcors":[132,134,107,108,150,192,192,169,172],"ycors":[85,64,51,17,2,18,52,65,87],"type":"polygon","color":"rgba(89, 176, 60, 1)","filled":true,"marked":false},{"xcors":[85,60,54,72,85,107],"ycors":[204,233,254,266,252,210],"type":"polygon","color":"rgba(89, 176, 60, 1)","filled":true,"marked":false},{"xcors":[119,179,209,224,220,175,128,81,74,88],"ycors":[75,75,101,135,225,261,261,224,135,99],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true}]},"wheel":{"name":"wheel","editableColorIndex":0,"rotate":false,"elements":[{"x":3,"y":3,"diam":294,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x":30,"y":30,"diam":240,"type":"circle","color":"rgba(0, 0, 0, 1)","filled":true,"marked":false},{"x1":150,"y1":285,"x2":150,"y2":15,"type":"line","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true},{"x1":15,"y1":150,"x2":285,"y2":150,"type":"line","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true},{"x":120,"y":120,"diam":60,"type":"circle","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"x1":216,"y1":40,"x2":79,"y2":269,"type":"line","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true},{"x1":40,"y1":84,"x2":269,"y2":221,"type":"line","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true},{"x1":40,"y1":216,"x2":269,"y2":79,"type":"line","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true},{"x1":84,"y1":40,"x2":221,"y2":269,"type":"line","color":"rgba(141, 141, 141, 1)","filled":false,"marked":true}]},"x":{"name":"x","editableColorIndex":0,"rotate":false,"elements":[{"xcors":[270,225,30,75],"ycors":[75,30,225,270],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true},{"xcors":[30,75,270,225],"ycors":[75,30,225,270],"type":"polygon","color":"rgba(141, 141, 141, 1)","filled":true,"marked":true}]}};
var modelConfig =
  (
    (typeof global !== "undefined" && global !== null) ? global :
    (typeof window !== "undefined" && window !== null) ? window :
    {}
  ).modelConfig || {};
var modelPlotOps = (typeof modelConfig.plotOps !== "undefined" && modelConfig.plotOps !== null) ? modelConfig.plotOps : {};
modelConfig.plots = [(function() {
  var name    = 'Global Temperature';
  var plotOps = (typeof modelPlotOps[name] !== "undefined" && modelPlotOps[name] !== null) ? modelPlotOps[name] : new PlotOps(function() {}, function() {}, function() {}, function() { return function() {}; }, function() { return function() {}; }, function() { return function() {}; }, function() { return function() {}; });
  var pens    = [new PenBundle.Pen('default', plotOps.makePenOps, false, new PenBundle.State(15, 1, PenBundle.DisplayMode.Line), function() {}, function() {
    return ProcedurePrims.runInPlotContext('Global Temperature', 'default', function() { plotManager.plotValue(world.observer.getGlobal("temperature"));; });
  })];
  var setup   = function() {};
  var update  = function() {};
  return new Plot(name, pens, plotOps, "", "", false, true, 0, 10, 10, 20, setup, update);
})()];
var workspace = tortoise_require('engine/workspace')(modelConfig)([{ name: "rays", singular: "ray", varNames: [] }, { name: "IRs", singular: "IR", varNames: [] }, { name: "heats", singular: "heat", varNames: [] }, { name: "CO2s", singular: "CO2", varNames: [] }, { name: "clouds", singular: "cloud", varNames: ["cloud-speed", "cloud-id"] }])([], [])('globals [   sky-top      ;; y coordinate of top row of sky   earth-top    ;; y coordinate of top row of earth   temperature  ;; overall temperature ]  breed [rays ray]     ;; packets of sunlight breed [IRs IR]       ;; packets of infrared radiation breed [heats heat]   ;; packets of heat energy breed [CO2s CO2]     ;; packets of carbon dioxide  breed [clouds cloud] clouds-own [cloud-speed cloud-id]  ;; ;; Setup Procedures ;;  to setup   clear-all   set-default-shape rays \"ray\"   set-default-shape IRs \"ray\"   set-default-shape clouds \"cloud\"   set-default-shape heats \"dot\"   set-default-shape CO2s \"CO2-molecule\"   setup-world   set temperature 12   reset-ticks end  to setup-world   set sky-top max-pycor - 5   set earth-top 0   ask patches [  ;; set colors for the different sections of the world     if pycor > sky-top [  ;; space       set pcolor scale-color white pycor 22 15     ]     if pycor <= sky-top and pycor > earth-top [ ;; sky       set pcolor scale-color blue pycor -20 20     ]     if pycor < earth-top       [ set pcolor red + 3 ] ;; earth     if pycor = earth-top ;; earth surface       [ update-albedo ]   ] end  ;; ;; Runtime Procedures ;;  to go   ask clouds [ fd cloud-speed ]  ; move clouds along   run-sunshine   ;; step sunshine   ;; if the albedo slider has moved update the color of the \"earth surface\" patches   ask patches with [pycor = earth-top]     [ update-albedo ]   run-heat  ;; step heat   run-IR    ;; step IR   run-CO2   ;; moves CO2 molecules   tick end  to update-albedo ;; patch procedure   set pcolor scale-color green albedo 0 1 end  to add-cloud            ;; erase clouds and then create new ones, plus one   let sky-height sky-top - earth-top   ;; find a random altitude for the clouds but   ;; make sure to keep it in the sky area   let y earth-top + (random-float (sky-height - 4)) + 2   ;; no clouds should have speed 0   let speed (random-float 0.1) + 0.01   let x random-xcor   let id 0   ;; we don\'t care what the cloud-id is as long as   ;; all the turtles in this cluster have the same   ;; id and it is unique among cloud clusters   if any? clouds   [ set id max [cloud-id] of clouds + 1 ]    create-clouds 3 + random 20   [     set cloud-speed speed     set cloud-id id     ;; all the cloud turtles in each larger cloud should     ;; be nearby but not directly on top of the others so     ;; add a little wiggle room in the x and ycors     setxy x + random 9 - 4           ;; the clouds should generally be clustered around the           ;; center with occasional larger variations           y + 2.5 + random-float 2 - random-float 2     set color white     ;; varying size is also purely for visualization     ;; since we\'re only doing patch-based collisions     set size 2 + random 2     set heading 90   ] end  to remove-cloud       ;; erase clouds and then create new ones, minus one   if any? clouds [     let doomed-id one-of remove-duplicates [cloud-id] of clouds     ask clouds with [cloud-id = doomed-id]       [ die ]   ] end  to run-sunshine   ask rays [     if not can-move? 0.3 [ die ]  ;; kill them off at the edge     fd 0.3                        ;; otherwise keep moving   ]   create-sunshine  ;; start new sun rays from top   reflect-rays-from-clouds  ;; check for reflection off clouds   encounter-earth   ;; check for reflection off earth and absorption end  to create-sunshine   ;; don\'t necessarily create a ray each tick   ;; as brightness gets higher make more   if 10 * sun-brightness > random 50 [     create-rays 1 [       set heading 160       set color yellow       ;; rays only come from a small area       ;; near the top of the world       setxy (random 10) + min-pxcor max-pycor     ]   ] end  to reflect-rays-from-clouds  ask rays with [any? clouds-here] [   ;; if ray shares patch with a cloud    set heading 180 - heading   ;; turn the ray around  ] end  to encounter-earth   ask rays with [ycor <= earth-top] [     ;; depending on the albedo either     ;; the earth absorbs the heat or reflects it     ifelse 100 * albedo > random 100       [ set heading 180 - heading  ] ;; reflect       [ rt random 45 - random 45 ;; absorb into the earth         set color red - 2 + random 4         set breed heats ]   ] end  to run-heat    ;; advances the heat energy turtles   ;; the temperature is related to the number of heat turtles   set temperature 0.99 * temperature + 0.01 * (12 + 0.1 * count heats)   ask heats   [     let dist 0.5 * random-float 1     ifelse can-move? dist       [ fd dist ]       [ set heading 180 - heading ] ;; if we\'re hitting the edge of the world, turn around     if ycor >= earth-top [  ;; if heading back into sky       ifelse temperature > 20 + random 40               ;; heats only seep out of the earth from a small area               ;; this makes the model look nice but it also contributes               ;; to the rate at which heat can be lost               and xcor > 0 and xcor < max-pxcor - 8         [ set breed IRs                    ;; let some escape as IR           set heading 20           set color magenta ]         [ set heading 100 + random 160 ] ;; return them to earth     ]   ] end  to run-IR   ask IRs [     if not can-move? 0.3 [ die ]     fd 0.3     if ycor <= earth-top [   ;; convert to heat if we hit the earth\'s surface again       set breed heats       rt random 45       lt random 45       set color red - 2 + random 4     ]     if any? CO2s-here    ;; check for collision with CO2       [ set heading 180 - heading ]   ] end  to add-CO2  ;; randomly adds 25 CO2 molecules to atmosphere   let sky-height sky-top - earth-top   create-CO2s 25 [     set color green     ;; pick a random position in the sky area     setxy random-xcor           earth-top + random-float sky-height   ] end  to remove-CO2 ;; randomly remove 25 CO2 molecules   repeat 25 [     if any? CO2s [       ask one-of CO2s [ die ]     ]   ] end  to run-CO2   ask CO2s [     rt random 51 - 25 ;; turn a bit     let dist 0.05 + random-float 0.1     ;; keep the CO2 in the sky area     if [not shade-of? blue pcolor] of patch-ahead dist       [ set heading 180 - heading ]     fd dist ;; move forward a bit   ] end   ; Copyright 2007 Uri Wilensky. ; See Info tab for full copyright and license.')([{"x":317,"y":12,"width":547,"height":350,"dimensions":{"minPxcor":-24,"maxPxcor":24,"minPycor":-8,"maxPycor":22,"patchSize":11,"wrappingAllowedInX":true,"wrappingAllowedInY":false},"fontSize":10,"updateMode":"TickBased","showTickCounter":true,"tickCounterLabel":"ticks","frameRate":30,"type":"view","compilation":{"success":true,"messages":[]}}, {"compiledSource":"var R = ProcedurePrims.callCommand(\"setup\"); if (R === StopInterrupt) { return R; }","source":"setup","x":6,"y":12,"width":95,"height":33,"display":"setup","forever":false,"buttonKind":"Observer","disableUntilTicksStart":false,"type":"button","compilation":{"success":true,"messages":[]}}, {"compiledSource":"var R = ProcedurePrims.callCommand(\"go\"); if (R === StopInterrupt) { return R; }","source":"go","x":103,"y":12,"width":95,"height":33,"display":"go","forever":true,"buttonKind":"Observer","disableUntilTicksStart":true,"type":"button","compilation":{"success":true,"messages":[]}}, {"compiledMin":"ProcedurePrims.rng.withAux(function() { return 0; })","compiledMax":"ProcedurePrims.rng.withAux(function() { return 5; })","compiledStep":"ProcedurePrims.rng.withAux(function() { return 0.2; })","variable":"sun-brightness","x":18,"y":47,"width":173,"height":33,"display":"sun-brightness","min":"0","max":"5","default":1,"step":"0.2","direction":"horizontal","type":"slider","compilation":{"success":true,"messages":[]}}, {"compiledMin":"ProcedurePrims.rng.withAux(function() { return 0; })","compiledMax":"ProcedurePrims.rng.withAux(function() { return 1; })","compiledStep":"ProcedurePrims.rng.withAux(function() { return 0.05; })","variable":"albedo","x":18,"y":82,"width":173,"height":33,"display":"albedo","min":"0","max":"1","default":0.6,"step":"0.05","direction":"horizontal","type":"slider","compilation":{"success":true,"messages":[]}}, {"compiledSetupCode":"function() {}","compiledUpdateCode":"function() {}","compiledPens":[{"compiledSetupCode":"function() {}","compiledUpdateCode":"function() {   return ProcedurePrims.runInPlotContext('Global Temperature', 'default', function() { plotManager.plotValue(world.observer.getGlobal(\"temperature\"));; }); }","display":"default","interval":1,"mode":0,"color":-2674135,"inLegend":true,"setupCode":"","updateCode":"plot temperature","type":"pen","compilation":{"success":true,"messages":[]}}],"display":"Global Temperature","x":9,"y":212,"width":269,"height":211,"xmin":0,"xmax":10,"ymin":10,"ymax":20,"autoPlotOn":true,"legendOn":false,"setupCode":"","updateCode":"","pens":[{"display":"default","interval":1,"mode":0,"color":-2674135,"inLegend":true,"setupCode":"","updateCode":"plot temperature","type":"pen"}],"type":"plot","compilation":{"success":true,"messages":[]}}, {"compiledSource":"var R = ProcedurePrims.callCommand(\"add-co2\"); if (R === StopInterrupt) { return R; }","source":"add-CO2","x":7,"y":152,"width":95,"height":33,"display":"add CO2","forever":false,"buttonKind":"Observer","disableUntilTicksStart":true,"type":"button","compilation":{"success":true,"messages":[]}}, {"compiledSource":"var R = ProcedurePrims.callCommand(\"remove-co2\"); if (R === StopInterrupt) { return R; }","source":"remove-CO2","x":104,"y":152,"width":95,"height":33,"display":"remove CO2","forever":false,"buttonKind":"Observer","disableUntilTicksStart":true,"type":"button","compilation":{"success":true,"messages":[]}}, {"compiledSource":"ProcedurePrims.rng.withAux(function() { return world.observer.getGlobal(\"temperature\"); })","source":"temperature","x":210,"y":87,"width":93,"height":45,"precision":1,"fontSize":11,"type":"monitor","compilation":{"success":true,"messages":[]}}, {"compiledSource":"var R = ProcedurePrims.callCommand(\"add-cloud\"); if (R === StopInterrupt) { return R; }","source":"add-cloud","x":7,"y":118,"width":95,"height":33,"display":"add cloud","forever":false,"buttonKind":"Observer","disableUntilTicksStart":true,"type":"button","compilation":{"success":true,"messages":[]}}, {"compiledSource":"var R = ProcedurePrims.callCommand(\"remove-cloud\"); if (R === StopInterrupt) { return R; }","source":"remove-cloud","x":104,"y":118,"width":95,"height":33,"display":"remove cloud","forever":false,"buttonKind":"Observer","disableUntilTicksStart":true,"type":"button","compilation":{"success":true,"messages":[]}}, {"compiledSource":"ProcedurePrims.rng.withAux(function() { return PrimChecks.agentset.count(world.turtleManager.turtlesOfBreed(\"CO2S\")); })","source":"count CO2s","x":210,"y":133,"width":93,"height":45,"display":"CO2 amount","precision":2,"fontSize":11,"type":"monitor","compilation":{"success":true,"messages":[]}}, {"compiledSource":"world.observer.watch(PrimChecks.list.oneOf(39, 45, world.turtleManager.turtlesOfBreed(\"RAYS\"))); var R = ProcedurePrims.ask(world.observer.subject(), function() { SelfManager.self().penManager.lowerPen(); }, true); if (R !== undefined) { PrimChecks.procedure.preReturnCheck(51, 54, R); return R; }","source":"watch one-of rays ask subject [ pen-down ]","x":208,"y":41,"width":101,"height":34,"display":"watch a ray","forever":false,"buttonKind":"Observer","disableUntilTicksStart":true,"type":"button","compilation":{"success":true,"messages":[]}}])(tortoise_require("extensions/all").porters())(["sun-brightness", "albedo", "sky-top", "earth-top", "temperature"], ["sun-brightness", "albedo"], [], -24, 24, -8, 22, 11, true, false, turtleShapes, linkShapes, function(){});
var Extensions = tortoise_require('extensions/all').initialize(workspace);
var BreedManager = workspace.breedManager;
var ImportExportPrims = workspace.importExportPrims;
var InspectionPrims = workspace.inspectionPrims;
var LayoutManager = workspace.layoutManager;
var LinkPrims = workspace.linkPrims;
var ListPrims = workspace.listPrims;
var MousePrims = workspace.mousePrims;
var OutputPrims = workspace.outputPrims;
var PrimChecks = workspace.primChecks;
var Prims = workspace.prims;
var PrintPrims = workspace.printPrims;
var ProcedurePrims = workspace.procedurePrims;
var RandomPrims = workspace.randomPrims;
var SelfManager = workspace.selfManager;
var SelfPrims = workspace.selfPrims;
var StringPrims = workspace.stringPrims;
var Updater = workspace.updater;
var UserDialogPrims = workspace.userDialogPrims;
var plotManager = workspace.plotManager;
var world = workspace.world;
ProcedurePrims.defineCommand("setup", 433, 668, (function() {
  world.clearAll();
  BreedManager.setDefaultShape(world.turtleManager.turtlesOfBreed("RAYS").getSpecialName(), "ray")
  BreedManager.setDefaultShape(world.turtleManager.turtlesOfBreed("IRS").getSpecialName(), "ray")
  BreedManager.setDefaultShape(world.turtleManager.turtlesOfBreed("CLOUDS").getSpecialName(), "cloud")
  BreedManager.setDefaultShape(world.turtleManager.turtlesOfBreed("HEATS").getSpecialName(), "dot")
  BreedManager.setDefaultShape(world.turtleManager.turtlesOfBreed("CO2S").getSpecialName(), "CO2-molecule")
  var R = ProcedurePrims.callCommand("setup-world"); if (R === DeathInterrupt) { return R; }
  world.observer.setGlobal("temperature", 12);
  world.ticker.reset();
}))
ProcedurePrims.defineCommand("setup-world", 676, 1134, (function() {
  world.observer.setGlobal("sky-top", PrimChecks.math.minus(712, 713, world.topology.maxPycor, 5));
  world.observer.setGlobal("earth-top", 0);
  var R = ProcedurePrims.ask(world.patches(), function() {
    if (Prims.gt(PrimChecks.patch.getVariable(812, 817, "pycor"), world.observer.getGlobal("sky-top"))) {
      PrimChecks.patch.setVariable(850, 856, "pcolor", ColorModel.scaleColor(9.9, PrimChecks.patch.getVariable(875, 880, "pycor"), 22, 15));
    }
    if ((Prims.lte(PrimChecks.patch.getVariable(900, 905, "pycor"), world.observer.getGlobal("sky-top")) && Prims.gt(PrimChecks.patch.getVariable(921, 926, "pycor"), world.observer.getGlobal("earth-top")))) {
      PrimChecks.patch.setVariable(958, 964, "pcolor", ColorModel.scaleColor(105, PrimChecks.patch.getVariable(982, 987, "pycor"), -20, 20));
    }
    if (Prims.lt(PrimChecks.patch.getVariable(1008, 1013, "pycor"), world.observer.getGlobal("earth-top"))) {
      PrimChecks.patch.setVariable(1038, 1044, "pcolor", PrimChecks.math.plus(1049, 1050, 15, 3));
    }
    if (Prims.equality(PrimChecks.patch.getVariable(1071, 1076, "pycor"), world.observer.getGlobal("earth-top"))) {
      var R = ProcedurePrims.callCommand("update-albedo"); if (R === DeathInterrupt) { return R; }
    }
  }, true); if (R !== undefined) { PrimChecks.procedure.preReturnCheck(736, 739, R); return R; }
}))
ProcedurePrims.defineCommand("go", 1171, 1496, (function() {
  var R = ProcedurePrims.ask(world.turtleManager.turtlesOfBreed("CLOUDS"), function() { SelfManager.self().fd(PrimChecks.turtle.getVariable(1192, 1203, "cloud-speed")); }, true); if (R !== undefined) { PrimChecks.procedure.preReturnCheck(1176, 1179, R); return R; }
  var R = ProcedurePrims.callCommand("run-sunshine"); if (R === DeathInterrupt) { return R; }
  var R = ProcedurePrims.ask(world._optimalPatchRow(world.observer.getGlobal("earth-top")), function() { var R = ProcedurePrims.callCommand("update-albedo"); if (R === DeathInterrupt) { return R; } }, true); if (R !== undefined) { PrimChecks.procedure.preReturnCheck(1347, 1350, R); return R; }
  var R = ProcedurePrims.callCommand("run-heat"); if (R === DeathInterrupt) { return R; }
  var R = ProcedurePrims.callCommand("run-ir"); if (R === DeathInterrupt) { return R; }
  var R = ProcedurePrims.callCommand("run-co2"); if (R === DeathInterrupt) { return R; }
  world.ticker.tick();
}))
ProcedurePrims.defineCommand("update-albedo", 1504, 1579, (function() {
  PrimChecks.patch.setVariable(1543, 1549, "pcolor", ColorModel.scaleColor(55, world.observer.getGlobal("albedo"), 0, 1));
}))
ProcedurePrims.defineCommand("add-cloud", 1587, 2772, (function() {
  let skyHheight = PrimChecks.math.minus(1684, 1685, PrimChecks.validator.checkArg('-', 1684, 1685, 1, world.observer.getGlobal("sky-top")), PrimChecks.validator.checkArg('-', 1684, 1685, 1, world.observer.getGlobal("earth-top"))); ProcedurePrims.stack().currentContext().registerStringRunVar("SKY-HEIGHT", skyHheight);
  let y = PrimChecks.math.plus(1837, 1838, PrimChecks.math.plus(1803, 1804, PrimChecks.validator.checkArg('+', 1803, 1804, 1, world.observer.getGlobal("earth-top")), PrimChecks.math.randomFloat(PrimChecks.math.minus(1831, 1832, PrimChecks.validator.checkArg('-', 1831, 1832, 1, skyHheight), 4))), 2); ProcedurePrims.stack().currentContext().registerStringRunVar("Y", y);
  let speed = PrimChecks.math.plus(1907, 1908, PrimChecks.math.randomFloat(0.1), 0.01); ProcedurePrims.stack().currentContext().registerStringRunVar("SPEED", speed);
  let x = RandomPrims.randomFloatInRange(world.topology.minPxcor, world.topology.maxPxcor); ProcedurePrims.stack().currentContext().registerStringRunVar("X", x);
  let id = 0; ProcedurePrims.stack().currentContext().registerStringRunVar("ID", id);
  if (PrimChecks.agentset.any(world.turtleManager.turtlesOfBreed("CLOUDS"))) {
    id = PrimChecks.math.plus(2146, 2147, PrimChecks.list.max(2121, 2124, PrimChecks.validator.checkArg('MAX', 2121, 2124, 8, PrimChecks.agentset.of(world.turtleManager.turtlesOfBreed("CLOUDS"), function() { return PrimChecks.turtle.getVariable(2126, 2134, "cloud-id"); }))), 1); ProcedurePrims.stack().currentContext().updateStringRunVar("ID", id);
  }
  var R = ProcedurePrims.ask(world.turtleManager.createTurtles(PrimChecks.math.plus(2171, 2172, 3, RandomPrims.randomLong(20)), "CLOUDS"), function() {
    PrimChecks.turtle.setVariable(2195, 2206, "cloud-speed", speed);
    PrimChecks.turtle.setVariable(2221, 2229, "cloud-id", id);
    PrimChecks.turtle.setXY(2403, 2408, PrimChecks.math.minus(2422, 2423, PrimChecks.math.plus(2411, 2412, PrimChecks.validator.checkArg('+', 2411, 2412, 1, x), RandomPrims.randomLong(9)), 4), PrimChecks.math.minus(2580, 2581, PrimChecks.math.plus(2563, 2564, PrimChecks.math.plus(2557, 2558, PrimChecks.validator.checkArg('+', 2557, 2558, 1, y), 2.5), PrimChecks.math.randomFloat(2)), PrimChecks.math.randomFloat(2)));
    PrimChecks.turtleOrLink.setVariable(2605, 2610, "color", 9.9);
    PrimChecks.turtle.setVariable(2731, 2735, "size", PrimChecks.math.plus(2738, 2739, 2, RandomPrims.randomLong(2)));
    PrimChecks.turtle.setVariable(2757, 2764, "heading", 90);
  }, true); if (R !== undefined) { PrimChecks.procedure.preReturnCheck(2155, 2168, R); return R; }
}))
ProcedurePrims.defineCommand("remove-cloud", 2780, 2995, (function() {
  if (PrimChecks.agentset.any(world.turtleManager.turtlesOfBreed("CLOUDS"))) {
    let doomedHid = PrimChecks.list.oneOf(2888, 2894, PrimChecks.list.removeDuplicates(PrimChecks.validator.checkArg('REMOVE-DUPLICATES', 2895, 2912, 8, PrimChecks.agentset.of(world.turtleManager.turtlesOfBreed("CLOUDS"), function() { return PrimChecks.turtle.getVariable(2914, 2922, "cloud-id"); })))); ProcedurePrims.stack().currentContext().registerStringRunVar("DOOMED-ID", doomedHid);
    var R = ProcedurePrims.ask(PrimChecks.agentset.with(2949, 2953, world.turtleManager.turtlesOfBreed("CLOUDS"), function() { return Prims.equality(PrimChecks.turtle.getVariable(2955, 2963, "cloud-id"), doomedHid); }), function() { return SelfManager.self().die(); }, true); if (R !== undefined) { PrimChecks.procedure.preReturnCheck(2938, 2941, R); return R; }
  }
}))
ProcedurePrims.defineCommand("run-sunshine", 3003, 3337, (function() {
  var R = ProcedurePrims.ask(world.turtleManager.turtlesOfBreed("RAYS"), function() {
    if (PrimChecks.math.not(SelfManager.self().canMove(0.3))) {
      return SelfManager.self().die();
    }
    SelfManager.self()._optimalFdLessThan1(0.3);
  }, true); if (R !== undefined) { PrimChecks.procedure.preReturnCheck(3018, 3021, R); return R; }
  var R = ProcedurePrims.callCommand("create-sunshine"); if (R === DeathInterrupt) { return R; }
  var R = ProcedurePrims.callCommand("reflect-rays-from-clouds"); if (R === DeathInterrupt) { return R; }
  var R = ProcedurePrims.callCommand("encounter-earth"); if (R === DeathInterrupt) { return R; }
}))
ProcedurePrims.defineCommand("create-sunshine", 3345, 3685, (function() {
  if (Prims.gt(PrimChecks.math.mult(3456, 3457, 10, PrimChecks.validator.checkArg('*', 3456, 3457, 1, world.observer.getGlobal("sun-brightness"))), RandomPrims.randomLong(50))) {
    var R = ProcedurePrims.ask(world.turtleManager.createTurtles(1, "RAYS"), function() {
      PrimChecks.turtle.setVariable(3517, 3524, "heading", 160);
      PrimChecks.turtleOrLink.setVariable(3539, 3544, "color", 45);
      PrimChecks.turtle.setXY(3635, 3640, PrimChecks.math.plus(3653, 3654, RandomPrims.randomLong(10), world.topology.minPxcor), world.topology.maxPycor);
    }, true); if (R !== undefined) { PrimChecks.procedure.preReturnCheck(3491, 3502, R); return R; }
  }
}))
ProcedurePrims.defineCommand("reflect-rays-from-clouds", 3693, 3849, (function() {
  var R = ProcedurePrims.ask(PrimChecks.agentset.with(3728, 3732, world.turtleManager.turtlesOfBreed("RAYS"), function() { return PrimChecks.agentset.any(SelfManager.self().breedHere("CLOUDS")); }), function() {
    PrimChecks.turtle.setVariable(3799, 3806, "heading", PrimChecks.math.minus(3811, 3812, 180, PrimChecks.validator.checkArg('-', 3811, 3812, 1, PrimChecks.turtle.getVariable(3813, 3820, "heading"))));
  }, true); if (R !== undefined) { PrimChecks.procedure.preReturnCheck(3719, 3722, R); return R; }
}))
ProcedurePrims.defineCommand("encounter-earth", 3857, 4208, (function() {
  var R = ProcedurePrims.ask(PrimChecks.agentset.with(3884, 3888, world.turtleManager.turtlesOfBreed("RAYS"), function() {
    return Prims.lte(PrimChecks.turtle.getVariable(3890, 3894, "ycor"), world.observer.getGlobal("earth-top"));
  }), function() {
    if (Prims.gt(PrimChecks.math.mult(4013, 4014, 100, PrimChecks.validator.checkArg('*', 4013, 4014, 1, world.observer.getGlobal("albedo"))), RandomPrims.randomLong(100))) {
      PrimChecks.turtle.setVariable(4047, 4054, "heading", PrimChecks.math.minus(4059, 4060, 180, PrimChecks.validator.checkArg('-', 4059, 4060, 1, PrimChecks.turtle.getVariable(4061, 4068, "heading"))));
    }
    else {
      SelfManager.self().right(PrimChecks.math.minus(4104, 4105, RandomPrims.randomLong(45), RandomPrims.randomLong(45)));
      PrimChecks.turtleOrLink.setVariable(4153, 4158, "color", PrimChecks.math.plus(4167, 4168, PrimChecks.math.minus(4163, 4164, 15, 2), RandomPrims.randomLong(4)));
      PrimChecks.turtleOrLink.setVariable(4190, 4195, "breed", world.turtleManager.turtlesOfBreed("HEATS"));
    }
  }, true); if (R !== undefined) { PrimChecks.procedure.preReturnCheck(3875, 3878, R); return R; }
}))
ProcedurePrims.defineCommand("run-heat", 4216, 5125, (function() {
  world.observer.setGlobal("temperature", PrimChecks.math.plus(4363, 4364, PrimChecks.math.mult(4349, 4350, 0.99, PrimChecks.validator.checkArg('*', 4349, 4350, 1, world.observer.getGlobal("temperature"))), PrimChecks.math.mult(4370, 4371, 0.01, PrimChecks.math.plus(4376, 4377, 12, PrimChecks.math.mult(4382, 4383, 0.1, PrimChecks.agentset.count(world.turtleManager.turtlesOfBreed("HEATS")))))));
  var R = ProcedurePrims.ask(world.turtleManager.turtlesOfBreed("HEATS"), function() {
    let dist = PrimChecks.math.mult(4430, 4431, 0.5, PrimChecks.math.randomFloat(1)); ProcedurePrims.stack().currentContext().registerStringRunVar("DIST", dist);
    if (SelfManager.self().canMove(dist)) {
      SelfManager.self().fd(dist);
    }
    else {
      PrimChecks.turtle.setVariable(4503, 4510, "heading", PrimChecks.math.minus(4515, 4516, 180, PrimChecks.validator.checkArg('-', 4515, 4516, 1, PrimChecks.turtle.getVariable(4517, 4524, "heading"))));
    }
    if (Prims.gte(PrimChecks.turtle.getVariable(4589, 4593, "ycor"), world.observer.getGlobal("earth-top"))) {
      if (((Prims.gt(world.observer.getGlobal("temperature"), PrimChecks.math.plus(4668, 4669, 20, RandomPrims.randomLong(40))) && Prims.gt(PrimChecks.turtle.getVariable(4893, 4897, "xcor"), 0)) && Prims.lt(PrimChecks.turtle.getVariable(4906, 4910, "xcor"), PrimChecks.math.minus(4923, 4924, world.topology.maxPxcor, 8)))) {
        PrimChecks.turtleOrLink.setVariable(4941, 4946, "breed", world.turtleManager.turtlesOfBreed("IRS"));
        PrimChecks.turtle.setVariable(5009, 5016, "heading", 20);
        PrimChecks.turtleOrLink.setVariable(5034, 5039, "color", 125);
      }
      else {
        PrimChecks.turtle.setVariable(5064, 5071, "heading", PrimChecks.math.plus(5076, 5077, 100, RandomPrims.randomLong(160)));
      }
    }
  }, true); if (R !== undefined) { PrimChecks.procedure.preReturnCheck(4399, 4402, R); return R; }
}))
ProcedurePrims.defineCommand("run-ir", 5133, 5478, (function() {
  var R = ProcedurePrims.ask(world.turtleManager.turtlesOfBreed("IRS"), function() {
    if (PrimChecks.math.not(SelfManager.self().canMove(0.3))) {
      return SelfManager.self().die();
    }
    SelfManager.self()._optimalFdLessThan1(0.3);
    if (Prims.lte(PrimChecks.turtle.getVariable(5203, 5207, "ycor"), world.observer.getGlobal("earth-top"))) {
      PrimChecks.turtleOrLink.setVariable(5290, 5295, "breed", world.turtleManager.turtlesOfBreed("HEATS"));
      SelfManager.self().right(RandomPrims.randomLong(45));
      SelfManager.self().right(-(RandomPrims.randomLong(45)));
      PrimChecks.turtleOrLink.setVariable(5350, 5355, "color", PrimChecks.math.plus(5364, 5365, PrimChecks.math.minus(5360, 5361, 15, 2), RandomPrims.randomLong(4)));
    }
    if (PrimChecks.agentset.any(SelfManager.self().breedHere("CO2S"))) {
      PrimChecks.turtle.setVariable(5450, 5457, "heading", PrimChecks.math.minus(5462, 5463, 180, PrimChecks.validator.checkArg('-', 5462, 5463, 1, PrimChecks.turtle.getVariable(5464, 5471, "heading"))));
    }
  }, true); if (R !== undefined) { PrimChecks.procedure.preReturnCheck(5142, 5145, R); return R; }
}))
ProcedurePrims.defineCommand("add-co2", 5486, 5737, (function() {
  let skyHheight = PrimChecks.math.minus(5568, 5569, PrimChecks.validator.checkArg('-', 5568, 5569, 1, world.observer.getGlobal("sky-top")), PrimChecks.validator.checkArg('-', 5568, 5569, 1, world.observer.getGlobal("earth-top"))); ProcedurePrims.stack().currentContext().registerStringRunVar("SKY-HEIGHT", skyHheight);
  var R = ProcedurePrims.ask(world.turtleManager.createTurtles(25, "CO2S"), function() {
    PrimChecks.turtleOrLink.setVariable(5607, 5612, "color", 55);
    PrimChecks.turtle.setXY(5669, 5674, RandomPrims.randomFloatInRange(world.topology.minPxcor, world.topology.maxPxcor), PrimChecks.math.plus(5707, 5708, PrimChecks.validator.checkArg('+', 5707, 5708, 1, world.observer.getGlobal("earth-top")), PrimChecks.math.randomFloat(PrimChecks.validator.checkArg('RANDOM-FLOAT', 5709, 5721, 1, skyHheight))));
  }, true); if (R !== undefined) { PrimChecks.procedure.preReturnCheck(5582, 5593, R); return R; }
}))
ProcedurePrims.defineCommand("remove-co2", 5745, 5865, (function() {
  for (let _index_5794_5800 = 0, _repeatcount_5794_5800 = StrictMath.floor(25); _index_5794_5800 < _repeatcount_5794_5800; _index_5794_5800++) {
    if (PrimChecks.agentset.any(world.turtleManager.turtlesOfBreed("CO2S"))) {
      var R = ProcedurePrims.ask(PrimChecks.validator.checkArg('ASK', 5831, 5834, 1904, PrimChecks.list.oneOf(5835, 5841, world.turtleManager.turtlesOfBreed("CO2S"))), function() { return SelfManager.self().die(); }, true); if (R !== undefined) { PrimChecks.procedure.preReturnCheck(5831, 5834, R); return R; }
    }
  }
}))
ProcedurePrims.defineCommand("run-co2", 5873, 6132, (function() {
  var R = ProcedurePrims.ask(world.turtleManager.turtlesOfBreed("CO2S"), function() {
    SelfManager.self().right(PrimChecks.math.minus(5911, 5912, RandomPrims.randomLong(51), 25));
    let dist = PrimChecks.math.plus(5948, 5949, 0.05, PrimChecks.math.randomFloat(0.1)); ProcedurePrims.stack().currentContext().registerStringRunVar("DIST", dist);
    if (PrimChecks.agentset.of(SelfManager.self().patchAhead(dist), function() {
      return PrimChecks.math.not(ColorModel.areRelatedByShade(105, PrimChecks.patch.getVariable(6030, 6036, "pcolor")));
    })) {
      PrimChecks.turtle.setVariable(6070, 6077, "heading", PrimChecks.math.minus(6082, 6083, 180, PrimChecks.validator.checkArg('-', 6082, 6083, 1, PrimChecks.turtle.getVariable(6084, 6091, "heading"))));
    }
    SelfManager.self().fd(dist);
  }, true); if (R !== undefined) { PrimChecks.procedure.preReturnCheck(5883, 5886, R); return R; }
}))
world.observer.setGlobal("sun-brightness", 1);
world.observer.setGlobal("albedo", 0.6);